<h2 mat-dialog-title>Payment for Order #{{ order.orderNumber }}</h2>

<mat-dialog-content>
  <div class="payment-container">
    <!-- Error Message -->
    <div *ngIf="error" class="error-message">
      <mat-icon>error</mat-icon>
      <span>{{ error }}</span>
    </div>

    <!-- Success Message -->
    <div *ngIf="success" class="success-message">
      <mat-icon>check_circle</mat-icon>
      <span>{{ success }}</span>
    </div>

    <!-- Loading Indicator -->
    <div *ngIf="loading" class="loading-indicator">
      <mat-icon class="spinner">refresh</mat-icon>
      <span>Processing your request...</span>
    </div>

    <!-- Order Summary -->
    <div class="order-summary">
      <h3>Order Summary</h3>
      <div class="summary-item">
        <span>Base Price:</span>
        <span>Rs. {{ order.basePrice | number:'1.2-2' }}</span>
      </div>
      <div *ngIf="order.transportationCost" class="summary-item">
        <span>Transportation Cost:</span>
        <span>Rs. {{ order.transportationCost | number:'1.2-2' }}</span>
      </div>
      <div *ngIf="order.additionalRentalCost" class="summary-item">
        <span>Additional Rental Cost:</span>
        <span>Rs. {{ order.additionalRentalCost | number:'1.2-2' }}</span>
      </div>
      <div class="summary-item total">
        <span>Total:</span>
        <span>Rs. {{ order.totalPrice | number:'1.2-2' }}</span>
      </div>
    </div>

    <!-- Payment Policy Notice -->
    <div class="payment-notice" *ngIf="isEventWithin24Hours">
      <mat-icon color="warn">schedule</mat-icon>
      <p class="notice-text">Your event is in less than 24 hours. Full payment is required to confirm your order.</p>
    </div>

    <div class="payment-options">
      <h3>Payment Options</h3>
      
      <!-- Payment Amount Options -->
      <div class="amount-options">
        <mat-radio-group [(ngModel)]="isFullPayment" (change)="onPaymentOptionChange()" [disabled]="isEventWithin24Hours">
          <mat-radio-button [value]="true">Pay Full Amount (Rs. {{ order.totalPrice | number:'1.2-2' }})</mat-radio-button>
          <mat-radio-button [value]="false" *ngIf="!isEventWithin24Hours && calculateHalfPayment() > 0">
            Pay 50% Now (Rs. {{ calculateHalfPayment() | number:'1.2-2' }})
          </mat-radio-button>
        </mat-radio-group>
      </div>
      
      <!-- Payment Method Selection -->
      <div class="payment-method">
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Payment Method</mat-label>
          <mat-select [(ngModel)]="paymentMethod">
            <mat-option value="payhere">Pay with PayHere</mat-option>
            <mat-option value="bank-transfer">Bank Transfer</mat-option>
            <mat-option value="online-transfer">Online Transfer</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      
      <!-- File Upload for Bank/Online Transfer -->
      <div *ngIf="paymentMethod !== 'payhere'" class="file-upload">
        <p>Please upload your payment slip:</p>
        <button mat-stroked-button (click)="fileInput.click()" class="upload-btn" [disabled]="loading">
          <mat-icon>file_upload</mat-icon>
          Select Payment Slip
        </button>
        <input hidden (change)="onFileSelected($event)" #fileInput type="file" accept="image/*">
        
        <!-- Show selected file name -->
        <div *ngIf="selectedFile" class="selected-file">
          <mat-icon>attach_file</mat-icon>
          <span class="file-name">{{ selectedFile.name }}</span>
          <button mat-icon-button (click)="selectedFile = null; fileInput.value = ''">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        
        <!-- File validation error -->
        <div *ngIf="fileValidationError" class="file-error">
          <mat-icon>warning</mat-icon>
          <span>{{ fileValidationError }}</span>
        </div>
        
        <!-- File upload instructions -->
        <div class="file-instructions" *ngIf="!selectedFile && !fileValidationError">
          <p>Accepted file types: JPG, PNG, GIF (max size: 5MB)</p>
        </div>

        <!-- Payment Notes Field -->
        <mat-form-field appearance="fill" class="full-width payment-notes">
          <mat-label>Payment Notes (optional)</mat-label>
          <textarea matInput [(ngModel)]="paymentNotes" placeholder="Any additional information about your payment"></textarea>
        </mat-form-field>
      </div>

      <!-- Payment Status Notice -->
      <div class="payment-status-notice" *ngIf="paymentMethod !== 'payhere'">
        <mat-icon color="primary">info</mat-icon>
        <p class="notice-text">After uploading your payment slip, our admin will verify it. You'll receive a confirmation once approved.</p>
      </div>
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button [disabled]="loading" (click)="closeDialog()">Cancel</button>
  <button 
    mat-raised-button 
    color="primary" 
    [disabled]="loading || (paymentMethod !== 'payhere' && !selectedFile)" 
    (click)="onSubmit()">
    <mat-icon *ngIf="loading" class="spinner">refresh</mat-icon>
    <span *ngIf="!loading">Process Payment</span>
  </button>
</mat-dialog-actions>